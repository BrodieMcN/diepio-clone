<!DOCTYPE html>
<html>
	<head>
		<title>peip.io</title>
	</head>
	<body>
		<style>
			
			html, body, canvas {
			
				margin: 0;
				padding: 0;
				overflow: hidden;
			
			}
			
		</style>
		<canvas id="canvas" width="800px" height="600px"></canvas>
		<script>
			
			var canvas = document.getElementById("canvas");
			canvas.width = window.innerWidth;
			canvas.height = window.innerHeight;
			var c = canvas.getContext("2d");
			c.lineCap = "round";
			var mouseIsPressed = false;
			var mouseClicked = false;
			var autofire = false;
			var autospin = false;
			var tanks = [];
			var keys = [];
			var bullets = [];
			var shapes = [];
			var camx = 0;
			var camy = 0;
			var mousex = 0;
			var mousey = 0;
			var millis = 0;
			
			function shape(x, y, id) {
			
				this.x = x;
				this.y = y;
				this.id = id;
				this.r = 0.01 - Math.random() / 50;
				this.rot = 0;
				this.velx = Math.random() / 10;
				this.vely = Math.random() / 10;
				
				this.update = function() {
				
					this.x -= this.velx;
					this.y -= this.vely;
					this.rot -= this.r;
				
				};
				
				this.show = function() {
				
					c.save();
					c.translate(this.x, this.y);
					c.rotate(this.rot);
					
					switch(this.id) {
					
						case 0:
							c.fillStyle = "rgb(250, 250, 150)";
							c.strokeStyle = "rgb(200, 200, 100)";
                        
							c.fillRect(-15, -15, 30, 30);
							
							c.beginPath();
							c.moveTo(-15, -15);
							c.lineTo(15, -15);
							c.stroke();
							
							c.beginPath();
							c.moveTo(15, -15);
							c.lineTo(15, 15);
							c.stroke();
							
							c.beginPath();
							c.moveTo(15, 15);
							c.lineTo(-15, 15);
							c.stroke();
                        
							c.beginPath();
							c.moveTo(-15, 15);
							c.lineTo(-15, -15);
							c.stroke();
							break;
					
						case 1:
							c.fillStyle = "rgb(250, 150, 150)";
							c.strokeStyle = "rgb(200, 100, 100)";
                        
							c.beginPath();
							c.moveTo(-26, 15);
							c.lineTo(0, -30);
							c.lineTo(26, 15);
                            c.fill();
                        
							c.beginPath();
							c.moveTo(26, 15);
							c.lineTo(0, -30);
                            c.stroke();
                        
							c.beginPath();
							c.moveTo(0, -30);
							c.lineTo(-26, 15);
                            c.stroke();
                        
							c.beginPath();
							c.moveTo(-26, 15);
							c.lineTo(26, 15);
                            c.stroke();
							break;
					
						case 2:
							c.fillStyle = "rgb(150, 150, 250)";
							c.strokeStyle = "rgb(100, 100, 200)";
                        
							c.beginPath();
							c.moveTo(0, 40);
							c.lineTo(38, 12);
							c.lineTo(24, -32);
							c.lineTo(-24, -32);
							c.lineTo(-38, 12);
							c.lineTo(0, 40);
							c.fill();
                        
							c.beginPath();
							c.moveTo(0, 40);
							c.lineTo(38, 12);
							c.stroke();
                        
							c.beginPath();
							c.moveTo(38, 12);
							c.lineTo(24, -32);
							c.stroke();
                        
							c.beginPath();
							c.moveTo(24, -32);
							c.lineTo(-24, -32);
							c.stroke();
                        
							c.beginPath();
							c.moveTo(-24, -32);
							c.lineTo(-38, 12);
							c.stroke();
                        
							c.beginPath();
							c.moveTo(-38, 12);
							c.lineTo(0, 40);
							c.stroke();
							break;
					
					}
					
					c.restore();
				
				};
			
			}
			
			function bullet(x, y, dx, dy, r, id, t, s, d, p) {
			
				this.x = x;
				this.y = y;
				this.dx = this.x - dx;
				this.dy = this.y - dy;
				this.mag = Math.sqrt(this.dx * this.dx + this.dy * this.dy);
				this.r = r;
				this.id = id;
				this.t = t;
				this.s = s;
				this.d = d;
				this.p = p;
				
				this.update = function() {
				
					this.x -= (this.dx / this.mag) * this.s;
					this.y -= (this.dy / this.mag) * this.s;
					
					this.p -= 0.01;
				
				};
				
				this.show = function() {
				
					c.beginPath();
					
					switch(this.id) {
					
						case 0:
							switch (this.t) {
							    case 0:
								c.fillStyle = "rgb(150, 150, 250)";
								c.strokeStyle = "rgb(100, 100, 200)";
								break;
							    case 1:
								c.fillStyle = "rgb(250, 150, 150)";
								c.strokeStyle = "rgb(200, 100, 100)";
								break;
							    case 2:
								c.fillStyle = "rgb(150, 250, 150)";
								c.strokeStyle = "rgb(100, 200, 100)";
								break;
							    case 3:
								c.fillStyle = "rgb(250, 150, 250)";
								c.strokeStyle = "rgb(200, 100, 200)";
								break;
							}
							c.arc(this.x, this.y, this.r, 0, 2 * Math.PI);
							c.fill();
							c.stroke();
					
					}
				
				};
			
			}
			
			function tank(x, y, r, t, n, xp, lvl, id, inv) {
			    this.x = x;
			    this.y = y;
			    this.velx = 0;
			    this.vely = 0;
			    this.acc = 0.1;
			    this.maxSpeed = 3;
			    this.bulletP = 3;
			    this.bulletS = 3;
			    this.bulletD = 3;
			    this.r = r;
			    this.t = t;
			    this.n = n;
			    this.xp = xp;
			    this.lvl = lvl;
			    this.id = id;
			    this.inv = inv;
				this.reload = 500;
                this.reloading = false;
				this.cooldown = this.reload;
				this.timetill = 0;
				
			    this.update = function(r) {
					
					if(mouseIsPressed || keys[32]) {
					
						if(this.cooldown === this.reload && !this.reloading) {
						
							bullets.push(new bullet(this.x + Math.sin(this.r) * 50, this.y - Math.cos(this.r) * 50, this.x + Math.sin(this.r) * 70, this.y - Math.cos(this.r) * 70, 10, 0, this.t, this.bulletS, this.bulletD, this.bulletP));
							
                            this.reloading = true;
							
							return;
						
						}
					
					}
                  
                    if(this.reloading){
						this.cooldown -= 100;
						this.timetill = millis;
                    }
                  
                    if(this.cooldown <= 0){
                        this.cooldown = 0;
                        this.reloading = false;
                    }
						
					if(this.cooldown !== this.reload && !this.reloading) {
						
						if(this.cooldown < this.reload) {
							this.cooldown = millis - this.timetill;
						} else {
							this.cooldown = this.reload;
						}
								
					}
					
					this.r = r;

					if(keys[87] && !keys[83]) {this.vely -= this.acc;}
					if(keys[83] && !keys[87]) {this.vely += this.acc;}
					if(keys[65] && !keys[68]) {this.velx -= this.acc;}
					if(keys[68] && !keys[65]) {this.velx += this.acc;}
				    
				    if(this.velx > this.maxSpeed) {this.velx = this.maxSpeed;}
				    if(this.velx < -this.maxSpeed) {this.velx = -this.maxSpeed;}
				    if(this.vely > this.maxSpeed) {this.vely = this.maxSpeed;}
				    if(this.vely < -this.maxSpeed) {this.vely = -this.maxSpeed;}

					if(!keys[87] && !keys[83]) {
						if(this.vely < 0) {this.vely += this.acc;}
						if(this.vely > 0) {this.vely -= this.acc;}
						
						if(Math.abs(this.vely) <= this.acc) {this.vely = 0;}
					}
					if(!keys[65] && !keys[68]) {
						if(this.velx < 0) {this.velx += this.acc;}
						if(this.velx > 0) {this.velx -= this.acc;}
						
						if(Math.abs(this.velx) <= this.acc) {this.velx = 0;}
					}
					
					this.x += this.velx;
					this.y += this.vely;
				    
				    
			    };
				
			    this.show = function() {
					c.save();
					c.translate(this.x, this.y);
					c.rotate(this.r);
					c.fillStyle = "rgb(200, 200, 200)";
					c.strokeStyle = "rgb(150, 150, 150)";
					c.fillRect(-10, 0, 20, -55 * (1 - (this.reload - this.cooldown) / 3000));
                    c.beginPath();
                    c.moveTo(-10, 0);
                    c.lineTo(-10, -55 * (1 - (this.reload - this.cooldown) / (this.reload * 8)));
                    c.stroke();
                    c.beginPath();
                    c.moveTo(-10, -55 * (1 - (this.reload - this.cooldown) / (this.reload * 8)));
                    c.lineTo(10, -55 * (1 - (this.reload - this.cooldown) / (this.reload * 8)));
                    c.stroke();
                    c.beginPath();
                    c.moveTo(10, 0);
                    c.lineTo(10, -55 * (1 - (this.reload - this.cooldown) / (this.reload * 8)));
                    c.stroke();
					switch (this.t) {
						case 0:
						c.fillStyle = "rgb(150, 150, 250)";
						c.strokeStyle = "rgb(100, 100, 200)";
						break;
						case 1:
						c.fillStyle = "rgb(250, 150, 150)";
						c.strokeStyle = "rgb(200, 100, 100)";
						break;
						case 2:
						c.fillStyle = "rgb(150, 250, 150)";
						c.strokeStyle = "rgb(100, 200, 100)";
						break;
						case 3:
						c.fillStyle = "rgb(250, 150, 250)";
						c.strokeStyle = "rgb(200, 100, 200)";
						break;
					}
					c.beginPath();
					c.arc(0, 0, 30, 0, 2 * Math.PI);
					c.fill();
					c.stroke();
					c.restore();
				};
			}
			tanks.push(new tank(50, 50, 0, 0, "test", 0, 0, 1, 1));
          
			for(var i = 0; i < 1000 - (shapes.length - 1); i++) {
				
				shapes.push(new shape(Math.round(Math.random() * 6000) - 3000, Math.round(Math.random() * 6000) - 3000, Math.round(Math.random() * 2)));
				
			}
			
			function draw() {
				
				millis = new Date();
				millis = millis.getTime();
				
			    camx = (canvas.width / 2) - tanks[0].x;
			    camy = (canvas.height / 2) - tanks[0].y;
				
			    c.fillStyle = "white";
			    c.fillRect(0, 0, canvas.width, canvas.height);
				
			    c.save();
			    c.translate(camx, camy);
				
			    c.lineWidth = 5;
			    c.strokeStyle = "rgb(200, 200, 200)";
				
			    for (var i = 0; i < 200; i++) {
					c.beginPath();
					c.moveTo(-3000, i * 30);
					c.lineTo(3000, i * 30);
					c.stroke();
					c.beginPath();
					c.moveTo(i * 30, -3000);
					c.lineTo(i * 30, 3000);
					c.stroke();
			 	}
				
				for(var i = shapes.length - 1; i >= 0; i--) {
				
					shapes[i].show();
					shapes[i].update();
				
				}
				
				for(var i = bullets.length - 1; i >= 0; i--) {
				
					bullets[i].show();
					bullets[i].update();
					
					if(bullets[i].p <= 0) {
						bullets.splice(i, 1);
					}
				
				}
				
				for(var i = tanks.length - 1; i >= 0; i--) {
					tanks[i].show();
					tanks[i].update(Math.atan2(-(tanks[i].x - (mousex - camx)), (tanks[i].y - (mousey - camy))));
				}
				
				c.restore();
				
				mouseClicked = false;
				
				c.fillStyle = "black";
				
				c.fillText(tanks[0].x.toFixed() + ", " + tanks[0].y.toFixed(), 100, 65);
				
				window.requestAnimationFrame(draw);
				
			}
			
			window.requestAnimationFrame(draw);
			window.addEventListener("mousemove", function(e) {mousex = e.clientX; mousey = e.clientY;});
			window.addEventListener("mousedown", function() {mouseIsPressed = true;});
			window.addEventListener("mouseup", function() {mouseIsPressed = false; mouseClicked = true;});
			window.addEventListener("keydown", function(e) {keys[e.keyCode] = true;});
			window.addEventListener("keyup", function(e) {keys[e.keyCode] = false;});
			
		</script>
	</body>
</html>
